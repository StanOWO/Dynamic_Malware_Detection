# -*- coding: utf-8 -*-
"""
Created on Tue Apr 16 23:54:00 2024

@author: Stan Wang
"""
import cv2 
import pandas as pd
import os 
import json
import numpy as np

def add_data(call, key, value):
    if key in call:
        call[key].append(value)
    else:
        call[key] = [value]

def add_result(result, key, value, time_range):
    if not(key in result):
        result[key] = [0] * 16
    for i in range(16):
        if time_range[i] > value:
            result[key][i] += 1
            break

def dataToColor(category,row_data) ->list :
    color_data=[]
    for i in row_data:
        for index, number in enumerate(numberRange):
            if i<=number :
                break
            if index==9:
                index+=1
        color_data.append(colorData.loc[category][index+1])
    return color_data

def jsonToImg(files,image) -> None :
    file_length=len(files)
    for counter, filename in enumerate(files):
        print(f"label {counter+1}/{file_length}: {filename}")
        with open(json_file_path + filename , "r") as f:
            data = json.load(f)
            
        for counter2,category2 in enumerate(colorData.index):
            if category2 in data:
                category= category2
                row_data = data[category]
            else:
                category="other"
                row_data=[0 for i in range(16)]
            
            color_data= dataToColor(category,row_data)
            for counter3,colorHex in enumerate(color_data):
                colorHex=colorHex.lstrip("#")
                r=int(colorHex[0:2],16)
                g=int(colorHex[2:4],16)
                b=int(colorHex[4:6],16)
                image[counter2-1][counter3]=(b,g,r)
        
        cv2.imwrite("./image_data/"+filename[:-5]+".png", image)
        print("done")
        
def main(json_file_path, colorData, numberRange):
    files= os.listdir(json_file_path)
    image=np.ones((16,16,3), dtype="uint8" ) * 255
    jsonToImg(files,image)
    
if __name__=="__main__":
    json_file_path = "./json_data/"
    
    colorData=pd.read_csv("color.csv",index_col=0,header=None)
    numberRange=[0,3,7,12,18,25,33,42,100,200]
    
    main(json_file_path, colorData, numberRange)